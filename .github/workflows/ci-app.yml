name: CI Validation

on:
  pull_request:
    branches: [main, develop]
  push:
    branches: [main, develop]

jobs:
  validate:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install dependencies
        run: |
          pip install black isort flake8 pytest safety bandit

      - name: Code formatting (Black)
        run: black --check . || echo "::warning::Black formatting issues found - run 'black .' to fix"
        continue-on-error: true

      - name: Import sorting (isort)
        run: isort --check-only --profile black . || echo "::warning::isort issues found - run 'isort .' to fix"
        continue-on-error: true

      - name: Linting (Flake8)
        run: flake8 --max-line-length=88 --extend-ignore=E203,W503 . || echo "::warning::Flake8 issues found"
        continue-on-error: true

      - name: Unit tests (pytest)
        run: pytest || echo "::warning::Some tests failed or no tests found"
        continue-on-error: true

      - name: Security scan (Safety)
        run: safety check || echo "::warning::Dependency vulnerabilities found"
        continue-on-error: true

      - name: Security scan (Bandit)
        run: bandit -r . -ll || echo "::warning::Security issues found"
        continue-on-error: true

      - name: PR status check
        if: github.event_name == 'pull_request'
        run: echo "PR validation complete."
